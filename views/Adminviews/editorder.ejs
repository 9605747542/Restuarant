<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="author" content="DexignZone">
	<meta name="robots" content="">
	<meta name="keywords" content="admin dashboard, admin template, administration, analytics, bootstrap, cafe admin, elegant, food, health, kitchen, modern, responsive admin dashboard, restaurant dashboard">
	<meta name="description" content="Discover Davur - the ultimate admin dashboard and Bootstrap 5 template. Specially designed for professionals, and for business. Davur provides advanced features and an easy-to-use interface for creating a top-quality website with frontend">
	<meta property="og:title" content="Davur : Restaurant Admin Dashboard + FrontEnd">
	<meta property="og:description" content="Discover Davur - the ultimate admin dashboard and Bootstrap 5 template. Specially designed for professionals, and for business. Davur provides advanced features and an easy-to-use interface for creating a top-quality website with frontend">
	<meta property="og:image" content="https://davur.dexignzone.com/xhtml/social-image.png">
	<meta name="format-detection" content="telephone=no">
	
	<!-- Mobile Specific -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<!-- Title -->
	<title>Davur : Restaurant Admin Dashboard + FrontEnd</title>
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="admin-assets/images/favicon.png">
    <link href="admin-assets/vendor/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet">
	<link href="admin-assets/vendor/datatables/css/jquery.dataTables.min.css" rel="stylesheet">
    <link href="admin-assets/css/style.css" rel="stylesheet">
	<link href="https://cdn.lineicons.com/2.0/LineIcons.css" rel="stylesheet">

</head>
<body>

    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
        <div class="sk-three-bounce">
            <div class="sk-child sk-bounce1"></div>
            <div class="sk-child sk-bounce2"></div>
            <div class="sk-child sk-bounce3"></div>
        </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->

    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">
	
	
		
			
		
		
						
		
		<!--**********************************
            Content body start
        ***********************************-->
        <div class="content-wrapper">
            <!-- row -->
			<div class="container-fluid">
				<div class="form-head dashboard-head d-md-flex d-block mb-5 align-items-start">
					<h2 class="dashboard-title me-auto">Bookings<a href="javascript:void(0);" class="btn btn-success btn-rounded ms-4 text-white d-inline-block flex-grow-1" data-bs-toggle="modal" data-bs-target="#exampleModal">
							Book New
							</a></h2>
							
					<div class="input-group search-area">
						<input type="text" class="form-control" placeholder="Search here...">
						<span class="input-group-text"><a href="javascript:void(0)"><i class="flaticon-381-search-2"></i></a></span>
					</div>
				</div>
				
				
				<!-- Modal -->
				
				
				
				
				<div class="row">
					<div class="col-12">
						<div class="table-responsive">
                            <form>
                                <table id="example5" class="display mb-4 defaultTable dataTablesCard" style="min-width: 845px;">
                                    <thead>
                                        <tr>
                                            <th>ORDERID</th>
                                            <th>CUSTOMERID</th>
                                            <th>ORDERDATE</th>
                                            <th>ORDER STATUS</th>
                                            <th>PAYMENT-METHOD</th>
                                            <th>TOTAL PRICE</th>
                                            <th>ACTION</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% for (let i = orders.length - 1; i >= 0; i--) { %>
                                            <tr>
                                                    <td class="orderId" contenteditable="true"><%= orders[i].orderId %></td>
                                                    <td class="userName" contenteditable="true"><%= orders[i].username %></td>
                                                    <td class="orderDate" contenteditable="true"><%= orders[i].orderDate.toLocaleDateString() %></td>
                                                    <td>
                                                        <select id="dropdown">
                                                          <option value="Order Placed">Order Placed</option>
                                                          <option value="Shipped">Shipped</option>
                                                          <option value="Delivery">Delivered</option>
                                                          <option value="Cancelled">Cancelled</option>
                                                          <option value="Returned">Returned</option>
                                                        </select>
                                                    </td>
                                     
                                                    <td class="orderStatus" contenteditable="true"><%= orders[i].paymentMethod %></td>
                                                    <td class="totalAmount" contenteditable="true"><%= orders[i].totalAmount %></td>
                                                    <td>
                                                        <button class="update-btn" data-order-id="<%= orders[i]._id %>" type="button">Update</button>


                                                    </td>
                                            </tr>
                                        <% } %>
                                    </tbody>
                                </table>
                            </form>
                            
						</div>
					</div>
				</div>
            </div>
        </div>
        <!--**********************************
            Content body end
        ***********************************-->
		
	


        <!--**********************************
            Footer start
        ***********************************-->
        <div class="footer p-0">
            <div class="copyright">
                <p>Copyright Â© Designed &amp; Developed by <a href="http://dexignzone.com/" target="_blank">DexignZone</a> 2023</p>
            </div>
        </div>
        <!--**********************************
            Footer end
        ***********************************-->

		<!--**********************************
           Support ticket button start
        ***********************************-->

        <!--**********************************
           Support ticket button end
        ***********************************-->


    </div>
    <!--**********************************
        Main wrapper end
    ***********************************-->

    <!--**********************************
        Scripts
    ***********************************-->
    <!-- Required vendors -->
    <script>
      document.querySelectorAll('.update-btn').forEach(button => {
    button.addEventListener('click', async () => {
        console.log("hello");

        // Extracting orderid from the button's class
        const orderid = button.getAttribute('data-order-id');
        console.log(orderid);

        const row = button.closest('tr');
        const orderId = row.querySelector('.orderId').textContent;
        const userName = row.querySelector('.userName').textContent;
         const orderDateStr = row.querySelector('.orderDate').textContent;
        const orderDateParts = orderDateStr.split('/'); // Splitting the date string
        const orderDate = new Date(orderDateParts[2], orderDateParts[1] - 1, orderDateParts[0]);

        // Get the selected value from the dropdown menu
        const orderStatus = document.getElementById("dropdown").value;
        console.log(orderStatus);
        
        const paymentMethod = row.querySelector('.orderStatus').textContent;
        console.log(paymentMethod);
        const totalAmount = row.querySelector('.totalAmount').textContent;
   
        const formData = {
            orderId,
            orderDate,
            userName,
            paymentMethod,
            orderStatus,
            totalAmount
        };

        try {
            const response = await fetch(`/updateorder/${orderid}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            });

            const data = await response.json();
            console.log(data);

				if (data.success===true) {
					Swal.fire({
            title: 'Success!',
            text: data.message,
            icon: 'success',
			})
			window.location.href='/getorders';
				} else {
					console.log(data.error);
					Swal.fire({
            title: 'Error!',
            text: data.message,
            icon: 'error',
          })
				}
			} catch (error) {
				console.log(error);
			}
		})
    })
           
        
  

    </script>
    	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/admin-assets/vendor/global/global.min.js"></script>
	<script src="/admin-assets/vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
	<!-- Datatable -->
    <script src="/admin-assets/vendor/datatables/js/jquery.dataTables.min.js"></script>
    <script src="/admin-assets/js/custom.min.js"></script>
	<script src="/admin-assets/js/deznav-init.js"></script>
	
	<script>
	(function($) {
	 
		var table = $('#example5').DataTable({
			searching: false,
			paging:true,
			select: false,
			//info: false,         
			lengthChange:false 
			
		});
		$('#example tbody').on('click', 'tr', function () {
			var data = table.row( this ).data();
			
		});
	   
	})(jQuery);
	</script>
	
</body>
</html>